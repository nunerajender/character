<% @model = @character_instance.user_model.constantize %>

<%= simple_form_for :objects, url: @action_url, method: :post do |form| %>
  <%= hidden_field_tag :class_name, @model.to_s %>

  <% (@objects || @model.all).each do |user| %>
    <div class='admin'>
      <%= form.simple_fields_for "[]", user do |f| %>
        <%= link_to 'http://gravatar.com', title: 'Change picture', target: '_blank', class: 'picture' do %>
          <%= image_tag user.gravatar_url(62) %>
        <% end %>

        <a class='action_delete' data-item-class='admin' href='#'><i class='fa fa-times'></i></a>
        <%= f.input :_destroy, as: :hidden, value: false %>

        <%= f.input :email, as: :email, required: true, label: false, placeholder: 'Email address...' %>
      <% end %>
    </div>
  <% end %>

  <template id='new_item_template'>
    <div class='admin'>
      <%= form.simple_fields_for "[]", @model.new do |f| %>
        <%= f.input :email, required: true, as: :email, label: false, placeholder: 'Email address...' %>
        <a class='action_cancel' data-item-class='admin' href='#'><i class='fa fa-times'></i></a>
      <% end %>
    </div>
  </template>
<% end %>